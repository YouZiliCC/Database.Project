# WebShell å®ç°è¯´æ˜

## ğŸ“‹ å®ç°æ¦‚è¿°

åŸºäº **terminal** å‘½åçš„æ–‡ä»¶å®ç°äº†å®Œæ•´çš„ WebShell åŠŸèƒ½ï¼Œä½¿ç”¨ **WebSocket + xterm.js + Docker Exec**ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
blueprints/
  â””â”€â”€ terminal.py           # Terminal è“å›¾ï¼ŒWebSocket äº‹ä»¶å¤„ç†
templates/project/
  â””â”€â”€ terminal.html         # Terminal é¡µé¢æ¨¡æ¿
static/
  â”œâ”€â”€ css/terminal.css      # Terminal æ ·å¼
  â””â”€â”€ js/terminal.js        # Terminal å‰ç«¯é€»è¾‘
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Flask-SocketIO (WebSocket)
- **å‰ç«¯**: Xterm.js (ç»ˆç«¯æ¨¡æ‹Ÿå™¨) + Socket.IO Client
- **Docker**: docker exec åˆ›å»ºäº¤äº’å¼ bash ä¼šè¯
- **æ ·å¼**: ç‹¬ç«‹çš„ terminal.css

## âœ¨ æ ¸å¿ƒç‰¹æ€§

1. **å®Œæ•´çš„ Bash Shell**: æ”¯æŒä»»æ„å‘½ä»¤ï¼ŒåŒ…æ‹¬ vimã€nano ç­‰
2. **å®æ—¶åŒå‘é€šä¿¡**: WebSocket å®ç°ä½å»¶è¿Ÿäº¤äº’
3. **å½©è‰²è¾“å‡º**: æ”¯æŒ xterm-256color
4. **æƒé™æ§åˆ¶**: åªæœ‰å·¥ä½œç»„æˆå‘˜å¯è®¿é—®
5. **è‡ªåŠ¨é€‚åº”**: ç»ˆç«¯å¤§å°è‡ªåŠ¨è°ƒæ•´
6. **ä¼šè¯ç®¡ç†**: æ–­å¼€è¿æ¥è‡ªåŠ¨æ¸…ç†èµ„æº

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–
```bash
pip install flask-socketio python-socketio
```

### 2. å¯åŠ¨åº”ç”¨
```bash
python main.py
```

### 3. è®¿é—® WebShell
1. è¿›å…¥é¡¹ç›®è¯¦æƒ…é¡µ
2. å¯åŠ¨ Docker å®¹å™¨
3. ç‚¹å‡» **"ğŸ–¥ï¸ WebShell ç»ˆç«¯"** æŒ‰é’®
4. åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å®Œæ•´çš„ Shell

## ğŸ“¡ WebSocket äº‹ä»¶

### å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨
- `start_shell`: å¯åŠ¨ Shell ä¼šè¯
- `input`: å‘é€ç”¨æˆ·è¾“å…¥
- `resize`: è°ƒæ•´ç»ˆç«¯å¤§å°

### æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯
- `ready`: Shell å·²å°±ç»ª
- `output`: å®¹å™¨è¾“å‡º
- `error`: é”™è¯¯ä¿¡æ¯
- `disconnected`: ä¼šè¯å…³é—­

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… Docker æ²™ç®±éš”ç¦»
- âœ… ç™»å½•è®¤è¯å¿…é¡»
- âœ… å·¥ä½œç»„æˆå‘˜æƒé™éªŒè¯
- âœ… å®¹å™¨è¿è¡ŒçŠ¶æ€æ£€æŸ¥
- âœ… ä¼šè¯è‡ªåŠ¨æ¸…ç†

## ğŸ“ è·¯ç”±è¯´æ˜

- `GET /terminal/<pid>`: ç»ˆç«¯é¡µé¢
- `WS /terminal`: WebSocket è¿æ¥ç«¯ç‚¹

## ğŸ¨ æ ·å¼ç‰¹ç‚¹

- ç‹¬ç«‹çš„ `terminal.css` æ–‡ä»¶
- æ¸å˜è‰²å¤´éƒ¨è®¾è®¡
- å“åº”å¼å¸ƒå±€
- çŠ¶æ€æŒ‡ç¤ºå¾½ç« 
- æš—è‰²ä¸»é¢˜ç»ˆç«¯

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

```bash
# æŸ¥çœ‹ç›®å½•
ls -la

# ç¼–è¾‘æ–‡ä»¶
vim hello.py

# è¿è¡Œ Python
python hello.py

# å®‰è£…åŒ…
pip install requests

# æŸ¥çœ‹è¿›ç¨‹
ps aux

# ä»»æ„ Linux å‘½ä»¤...
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. è¾“å…¥ `exit` ä¼šå…³é—­ä¼šè¯ï¼Œéœ€è¦åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥
2. Docker SDK çš„ exec ä¸å®Œå…¨æ”¯æŒç»ˆç«¯å¤§å°è°ƒæ•´
3. ç¡®ä¿å®¹å™¨ä¸­æœ‰ `/bin/bash` (å¤§éƒ¨åˆ†é•œåƒéƒ½æœ‰)
4. é•¿æ—¶é—´æ— æ“ä½œä¼šè¯å¯èƒ½è¶…æ—¶

## ğŸ› æ•…éšœæ’é™¤

### WebSocket è¿æ¥å¤±è´¥
- æ£€æŸ¥ flask-socketio æ˜¯å¦å·²å®‰è£…
- ç¡®è®¤ä½¿ç”¨ `socketio.run()` è€Œä¸æ˜¯ `app.run()`

### å®¹å™¨è¿æ¥å¤±è´¥
- ç¡®ä¿å®¹å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ Docker daemon æ˜¯å¦å¯è®¿é—®

### ç»ˆç«¯æ— å“åº”
- åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡å™¨æ—¥å¿—

## ğŸ“¦ ä¾èµ–é¡¹

```toml
dependencies = [
    "flask-socketio>=5.4.1",
    "python-socketio>=5.12.0",
    "docker>=7.1.0",
]
```

## ğŸ¯ æœªæ¥æ”¹è¿›

- [ ] æ”¯æŒå¤šä¸ªå¹¶å‘ä¼šè¯
- [ ] å‘½ä»¤å†å²è®°å½•æŒä¹…åŒ–
- [ ] ç»ˆç«¯å½•åˆ¶å’Œå›æ”¾
- [ ] æ›´å¥½çš„ç»ˆç«¯ resize æ”¯æŒ
- [ ] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½

---

å®ç°å®Œæˆï¼âœ¨ å°½æƒ…äº«å—åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å®Œæ•´ Shell çš„ä½“éªŒï¼
