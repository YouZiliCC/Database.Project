{% extends "base.html" %}
{% block title %}编辑个人信息 - Uniweb{% endblock %}
{% block content %}
    <div class="container">
        <h2>编辑个人信息</h2>
        <form method="POST"
              action="{{ url_for('user.user_edit') }}"
              class="form"
              enctype="multipart/form-data"
              id="edit-user-form">
            {{ form.hidden_tag() }}
            <div class="form-row">
                <label>{{ form.uname.label }}</label>
                {{ form.uname(size=32, **{"data-validate":"required|min:3|max:50"}) }}
                {% if form.uname.errors %}<span class="error">{{ form.uname.errors[0] }}</span>{% endif %}
            </div>
            <div class="form-row">
                <label>{{ form.email.label }}</label>
                {{ form.email(size=64, type="email", **{"data-validate":"required|email"}) }}
                {% if form.email.errors %}<span class="error">{{ form.email.errors[0] }}</span>{% endif %}
            </div>
            <div class="form-row">
                <label>{{ form.sid.label }}</label>
                {{ form.sid(size=10, **{"data-validate":"required|length:10"}) }}
                {% if form.sid.errors %}<span class="error">{{ form.sid.errors[0] }}</span>{% endif %}
            </div>
            <div class="form-row">
                <label>{{ form.uinfo.label }}</label>
                {{ form.uinfo(rows=6, placeholder="简单介绍一下自己...", maxlength=2000) }}
                <small class="form-text text-muted">支持 Markdown 格式，可使用 **粗体**、*斜体*、[链接](url)、列表等</small>
                {% if form.uinfo.errors %}<span class="error">{{ form.uinfo.errors[0] }}</span>{% endif %}
            </div>
            <div class="form-row">
                <label for="uimg">个人头像</label>
                {% set user_img = '/static/img/users/' + user.uid + '.png' %}
                <div class="image-preview">
                    <img src="{{ user_img }}"
                         alt="当前头像"
                         id="current-image"
                         onerror="this.src='/static/img/user.png';">
                </div>
                <input type="file"
                       id="uimg"
                       name="uimg"
                       accept="image/*"
                       onchange="previewImage(this)">
                <small class="form-text text-muted">支持 PNG, JPG, JPEG, GIF, WEBP 格式</small>
            </div>
            <div class="form-row">
                {{ form.submit(class="btn", value="保存更改") }}
                <a href="{{ url_for('user.user_me') }}" class="btn btn-secondary">取消</a>
                <button type="button" class="btn btn-danger" onclick="confirmDeleteAccount()">删除账号</button>
            </div>
        </form>
    </div>
{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static', filename='js/user.js') }}"></script>
    <script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.getElementById('current-image');
            img.src = e.target.result;
            img.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}
    </script>
{% endblock %}
